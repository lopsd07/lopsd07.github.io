# Postman

Postman 是一款可以方便我们调试、测试API的工具，甚至我们可以通过Postman 与 Newman结合，还可以批量运行API达到API自动化测试的目的。

## 变量的设置



编写的API往往需要在多个环境下执行，而Postman 提供了两种类型的变量：环境变量和全局变量，从而很好的解决了这个问题。同时变量还常用于关联接口间的参数传递。

环境变量有效范围仅仅在于当前集合可用，全局变量对所有的集合都可用。

### 环境变量

api可能需要在不同的环境中运行，所以api请求的服务器地址不能写死，希望是可以配置的，创建环境变量有多种方式。

1. 手工预先创建环境变量

2. 代码自动创建环境变量
   自动新建环境变量可在两种情况下创建，但是创建方式相同都是用了postman提供的方法：

```javascript
pm.environment.set("variable_key", "variable_value");
pm.collectionVariables.set("variable_key", "variable_value");
pm.globals.set("variable_key", "variable_value");
```

### INITIAL VALUE 和 CURRENT VALUE

在默认情况下，设置环境变量和全局变量一个 key(VARIABLE) 对应两个 value(INITIAL VALUE 和 CURRENT VALUE)，那这两个有啥区别？

- INITIAL VALUE ：初始值本地脚本运行时不会获取该值，该值主要用处Team模式或者导出变量时设定的默认值。
- CURRENT VALUE ：当前值则是实实在在本地脚本运行时使用的变量值，同时通过脚本设置变量时默认也是设置的是这个值。

### 变量的引用

在需要的地方加上 @{{变量名}} 即可。

### 随机数

PostMan 除了提供环境变量和全局变量外，还提供了三种随机数。

`{{$guid}}`：添加一个V4风格GUID

`{{$timestamp}}`：将当前的时间戳，精确到秒

`{{$randomInt}}`：添加0和1000之间的随机整数

## Script

Postman 提供了便捷的可视化界面操作，也提供了强大的脚本支持。Postman运行过程是基于强大的 Node.js，可以在请求发起前（Pre-request Script）和拿到请求返回后(Tests)，通过编写JavaScript来实现请求间数据传递，请求参数动态生成等等。

Pre-request Script 和 Tests 可以在集合（Collections）、夹（Folder）、请求（Request）中设置。估计大家可能会有个疑问，集合、夹、请求都只是指啥，这里补充一张图了解下Postman定义的名词，也算对上次分享的一个补充。

### 脚本执行顺序

在Postman中，单个请求的脚本执行顺序如下：

- 请求里的pre-request script 将在 Request 发起之前执行
- 请求里的Tests 将在Response 获取之后执行

对于一个集合里的请求，将按一下顺序执行

集合pre → 夹pre → 请求pre → Request → Response → 集合Tests → 夹Tests → 请求Tests

> 集合夹中的Pre-quest script 和 Tests script 是每个Request请求之前和Response之后都会执行一次。

## 参考链接

- [Postman 官网](https://www.postman.com/)
- [Newman](https://learning.postman.com/docs/running-collections/using-newman-cli/command-line-integration-with-newman/)
- [Postman 入门](https://www.yuque.com/miyang.meyoung/devops/sqk649)

